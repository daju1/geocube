 <html>
<head>
<title>FastCode - программирование, веб-программирование. Статьи и учебники по программированию и веб-дизайну, php, perl, asp, html, dhtml, java, javascript, css, xml, vrml, sql.</title>
<meta name="keywords" content="программирование, веб-программирование, статьи и учебники по программированию, веб-мастеру, веб-дизайн, php, perl, asp, html, dhtml, java, javascript, css, xml, vrml, sql">
<meta name="description" content="FastCode.ru - программирование, веб-программирование. Статьи и Учебники по программированию и веб-дизайну.">
<meta name="robots" content="index,follow">
<meta name="resource-type" content="document">
<meta name="revisit-after" content="5 days">
<meta http-equiv="Content-type" content="text/html; charset=windows-1251">
<link rel="stylesheet" type="text/css" href="/art/style.css">
</head>
<body topmargin="0" leftmargin="0" marginwidth="0" marginheight="0">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr>
<td colspan="7">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr>
<td background="/art/pic/images/lr_colums.gif" width="6"><img src="/art/pic/images/0.gif" height="1" width="6"></td>
<td width="100%">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr>
<td background="/art/pic/images/favor_bg.gif" height="27" valign="middle" style="color:#A1B9D8; font-size: 11px; padding-left: 20px"><a title="добавить в закладки" class="favor" href="javascript:window.external.AddFavorite%20('http://fastcode.ru','FastCode.ru - программирование, веб-программирование. Статьи и Учебники.')" 
onMouseOut="self.status=''; return true" 
onMouseOver="self.status='добавить в закладки!'; return true">добавить в закладки</a>  |  
<a title="установить домашней" class="favor" href="http://fastcode.ru/" 
onClick="this.style.behavior='url(#default#homepage)';this.setHomePage('http://fastcode.ru'); return false;">установить домашней</a>
</td>
</tr>
<tr>
<td background="/art/pic/images/logo_bg.jpg" height="91" valign="top">
<table cellpadding="0" cellspacing="0" border="0" width="100%" height="91">
<tr><a href="http://fastcode.ru/" title="FastCode - программирование, веб-программирование. Статьи и учебники по программированию и веб-дизайну, php, perl, asp, html, dhtml, java, javascript, css, xml, vrml, sql.">
<td title="FastCode - программирование, веб-программирование. Статьи и учебники по программированию и веб-дизайну, php, perl, asp, html, dhtml, java, javascript, css, xml, vrml, sql." width="287" align="left" background="/art/pic/images/logo.jpg" style="background-position:top; background-repeat:no-repeat"></td></a>
<td align="right" style="padding-right: 10px" valign="middle">
<OBJECT classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"
codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0" WIDTH="468" HEIGHT="60" id="optimism" ALIGN="">
<PARAM NAME=movie VALUE="/art/host.swf"> 
<PARAM NAME=quality VALUE=high> 
<PARAM NAME=bgcolor VALUE=#FFFFFF> 
<EMBED src="/art/host.swf" quality=high bgcolor=#FFFFFF  WIDTH="100%" HEIGHT="100%" NAME="optimism" ALIGN="" TYPE="application/x-shockwave-flash" PLUGINSPAGE="http://www.macromedia.com/go/getflashplayer"></EMBED>
</OBJECT>
</td>
</tr>
</table>
</td>
</tr>
<tr>
<td background="/art/pic/images/hor_menu_bg.gif" height="28">
<table cellpadding="0" cellspacing="0" border="0" width="100%" style="padding-left: 15px;" class="top_menu" height="28">
<tr>
<td width="75%" align="left" valign="middle">
<img src="/art/pic/images/menu_marker.gif" vspace="0" hspace="0" border="0">
<a href="/article/" title="Статьи по программированию и веб-программированию">Статьи</a>
<img src="/art/pic/images/menu_marker.gif" vspace="0" hspace="0" border="0">
<a href="/books/" title="Учебники по программированию и веб-программированию">Учебники</a>
<img src="/art/pic/images/menu_marker.gif" vspace="0" hspace="0" border="0">
<a href="/reklama/" title="Реклама на сайте">Реклама на сайте</a>
<img src="/art/pic/images/menu_marker.gif" vspace="0" hspace="0" border="0">
<a href="http://link.fastcode.ru/" title="Каталог ссылок">Каталог ссылок</a>
</td>
<td width="25%" align="center">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr>
<td width="100%"><FORM style="MARGIN-BOTTOM: 0px" name=web action=http://www.yandex.ru:8081/yandsearch method=get>
<INPUT type=hidden value=http://fastcode.ru/ name=serverurl>
<INPUT type=hidden value=fastcode.ru name=server_name>
<INPUT type=hidden value="Fastcode.ru - программирование и веб-программирование." name=referrer2>
<INPUT type=hidden value=fastcode.ru name=referrer1>
<input type="text" name="search" value="Поиск по сайту" class="inpt" style="width:100%"></td>
<td width="10"><img src="/art/pic/images/0.gif" width="10"></td>
<td><input type="image" src="/art/pic/images/find.gif"></FORM></td>
<td width="15"><img src="/art/pic/images/0.gif" width="20"></td>
</tr>
<tr>
<td><img src="/art/pic/images/0.gif" height="0" width="120"></td>
<td></td>
<td></td>
<td></td>
</tr>
</table>
</td>
</tr>
</table>
</td>
</tr>
<tr><td height="2" bgcolor="#AABBE1"><img src="/art/pic/images/0.gif" height="2"></td></tr>
<tr><td height="2" bgcolor="#BCC9E6"><img src="/art/pic/images/0.gif" height="2"></td></tr>
</table>
</td>
<td background="/art/pic/images/lr_colums_r.gif" width="6"><img src="/art/pic/images/0.gif" height="1" width="6"></td>
</tr>
</table>
</td>
</tr>
<tr>
<td background="/art/pic/images/lr_colums.gif" width="6"><img src="/art/pic/images/0.gif" height="1" width="6"></td>
<td width="23%" bgcolor="#E0E6F1" valign="top">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr>
<td height="36" background="/art/pic/images/vip_caption.gif" class="caption" valign="middle">
<img src="/art/pic/images/isubscribe.gif" height="16" width="16" hspace="15">Меню
</td>
</tr>
<tr>
<td background="/art/pic/images/left_block_bg.gif" style="padding-top: 15px; background-repeat: repeat-x">
<table cellpadding="0" cellspacing="0" border="0" width="100%" style="font-size: 11px;color:#404F71">
<tr>
<td style="padding-left: 25px">
<font color="#001262"><b class="theme">По проекту</b></font><br>
<font size="2" style="font-size: 9pt" color="#001262">
<span style="font-weight:bold">
<img src="/art/pic/images/theme_marker.gif"><span lang="ru"><a href="/"><font color="#001262" style="font-size: 9pt">Главная</font></a></span><br>
<img src="/art/pic/images/theme_marker.gif"></span></font><span style="font-size:11px;font-weight:bold"><font size="2" style="font-size: 9pt" color="#001262"><span style="font-weight:bold"><span lang="ru"><a href="/about/"><font color="#001262" style="font-size: 9pt">О 
Проекте</font></a></span><br>
<img src="/art/pic/images/theme_marker.gif"><span lang="ru"><a href="/reklama/"><font color="#001262" style="font-size: 9pt">Реклама 
на сайте</font></a></span><br>
<img src="/art/pic/images/theme_marker.gif"></span></font></span><span style="font-size:11px;font-weight:bold"><font size="2" style="font-size: 9pt" color="#001262"><span lang="ru" style="font-weight: bold"><a href="http://link.fastcode.ru/"><font color="#001262" style="font-size: 9pt">Каталог 
ссылок</font></a></span></font></span><span style="font-size:11px;font-weight:bold"><font size="2" style="font-size: 9pt" color="#001262"><span style="font-weight:bold"><br>
<img src="/art/pic/images/theme_marker.gif"><span lang="ru"><a href="/contact/"><font color="#001262" style="font-size: 9pt">Контакты</font></a></span>
<br><br>
</td>
<td></td>
</tr>
</table>
</td>
</tr>
<tr>
<td><img src="/art/pic/images/0.gif" width="202" height="0"></td>
</tr>
<tr>
<td height="36" background="/art/pic/images/vip_caption.gif" class="caption" valign="middle">
<img src="/art/pic/images/idocs.gif" height="12" width="15" hspace="15">Документы
</td>
</tr>
<tr>
<td background="/art/pic/images/left_block_bg.gif" style="padding-top: 15px; background-repeat: repeat-x;padding-left:25px;" class="themes">
<b class="theme">C/C++</b><br>
<span style="font-size:11px;font-weight:bold">
<img src="/art/pic/images/theme_marker.gif">
<a href="/visualc/" title="программирование - Visual C++">Visual C++</a><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/cplus/" title="программирование - Основы C++">Основы C++</a><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/cprof/" title="программирование - С++ для профессионалов">С++ для профессионалов</a>
<br><br>
<b class="theme">Delphi/Pascal/Basic</b><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/bpascal/" title="программирование - Borland Pascal">Borland Pascal</a><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/ycheb/tpascal.zip" title="программирование - Учебник по Turbo Pascal">Учебник по Turbo Pascal</a><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/ycheb/tpow.zip" title="программирование - Учебник по B.Pascal 7 & Objects/OW">B.Pascal 7 & Objects/OW</a><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/vb5/" title="программирование - Visual Basic">Visual Basic</a><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/dbvb/" title="программирование - БД в Visual Basic">БД в Visual Basic</a><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/ycheb/delphi6.zip" title="программирование - Учебник по Delphi 6">Учебник по Delphi 6</a><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/ycheb/delphi7.zip" title="программирование - Учебник по Delphi 7">Учебник по Delphi 7</a><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/ycheb/delphi7prof.zip" title="программирование - Delphi 7 для профессионалов">Delphi 7 for prof</a><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/ycheb/delphifaq.zip" title="программирование - Delphi FAQ">Delphi FAQ</a><br>
<br><br>
<b class="theme">Интернет</b><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/web/php/" title="веб-программирование - php">PHP</a><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/web/dhtml/" title="веб-программирование - DHTML">DHTML</a><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/web/css/" title="веб-программирование - CSS">CSS</a><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/web/vrml/" title="веб-программирование - VRML">VRML</a><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/web/xml/" title="веб-программирование - XML">XML</a><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/web/vbscript/" title="веб-программирование - VBScript">VBScript</a><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/web/perl/" title="веб-программирование - Perl">Perl</a><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/ycheb/java.rar" title="веб-программирование - Java">Java</a><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/ycheb/javascript.rar" title="веб-программирование - JavaScript">JavaScript</a><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/ycheb/sql.zip" title="веб-программирование - SQL">SQL</a><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/ycheb/mysql.rar" title="веб-программирование - MySQL">MySQL</a><br>
<br><br>
<b class="theme">Разное</b><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/fortran/" title="программирование - Fortran">Fortran</a><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/other/install/" title="создание своего инсталятор">Свой инсталятор</a><br>
<img src="/art/pic/images/theme_marker.gif">
<a href="/ycheb/bios.zip" title="программирование - Описание функций Bios">Описание функций Bios</a><br>
</span>
<p><p><p>
</td>
</tr>
</table>
</td>
<td width="6" background="/art/pic/images/spliter.gif" valign="top"><img src="/art/pic/images/spl.gif" width="6" height="106"></td>
<td width="54%" valign="top">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr>
<td width="100%" background="/art/pic/images/simple_caption.gif" height="36" valign="middle" style="padding-left:25px" class="center_menu">
<img src="/art/pic/images/center_marker.gif"><a href="/asm/" title="программирование на Ассемблере">Assembler</a>
<img src="/art/pic/images/center_marker.gif"><a href="/fortran/" title="программирование на Fortran">Fortran</a>
<img src="/art/pic/images/center_marker.gif"><a href="/bpascal/" title="программирование на Pascal">Pascal</a>
<img src="/art/pic/images/center_marker.gif"><a href="/vb5/" title="программирование на Basic">Basic</a>
<img src="/art/pic/images/center_marker.gif"><a href="/visualc/" title="программирование на C/C++">C/C++</a>
</td>
</tr>
<tr>
<td background="/art/pic/images/center_bg.gif" style="background-repeat:repeat-x;padding:10px">
<table cellpadding="10" cellspacing="0" border="0" width="100%">
<tr>
<td background="/art/pic/images/center_caption_bg.gif" height="36" class="caption" style="padding-left:15px">FastCode - программирование для всех.</td>
</tr>
<tr>
<td>
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr>
<td class="news_block_text"><br><H2 ALIGN="CENTER"><FONT FACE="Arial, Helvetica, sans-serif">Урок 32</FONT></H2>
<H2 ALIGN="CENTER"><FONT FACE="Arial, Helvetica, sans-serif"> Управление свободной 
памятью</FONT></H2>
<P> <FONT FACE="Times New Roman, Times, serif" SIZE="3">Из 
урока 31 вы узнали, что при выполнении ваши программы могут использовать оператор</FONT> 
<FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new</I> для динамического 
распределения памяти из свободной памяти. Если оператор</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new</I> 
успешно выделяет память, ваша программа получает на нее указатель. Если оператор</FONT> 
<FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new</I> не может выделить 
требуемую память, он присваивает вашей переменной-указателю значение NULL. В 
зависимости от назначения вашей программы, вы, возможно, захотите, чтобы программа 
выполнила определенные операции, если</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new</I> 
не может удовлетворить запрос на память. Из этого урока вы узнаете, как заставить 
C++ вызвать специальную функцию, если</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new</I> 
не может удовлетворить запрос на память. К концу данного урока вы освоите следующие 
основные концепции:</FONT></P>
<UL>
<LI><FONT FACE="Times New Roman, Times, serif" SIZE="3">Вы можете создать свой 
собственный обработчик ситуации, когда памяти недостаточно — функции, которую 
C++ вызывает, если</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new 
не</I> может удовлетворить запрос на память.</FONT></LI>
<LI><FONT FACE="Times New Roman, Times, serif" SIZE="3">C++ позволяет вам определить 
собственный оператор</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new 
для</I> выделения и, возможно, инициализации памяти.</FONT></LI>
<LI><FONT FACE="Times New Roman, Times, serif" SIZE="3">C++ позволяет вам определить 
собственный оператор</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>delete</I> 
для освобождения памяти.</FONT></LI>
</UL>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">Как вы узнаете, с помощью 
собственных операторов</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new</I> 
и</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>delete</I> вы 
можете лучше управлять ошибками при недостаточности памяти.</FONT></P>
<H2 ALIGN="CENTER"><FONT FACE="Arial, Helvetica, sans-serif">СОЗДАНИЕ ОБРАБОТЧИКА 
ДЛЯ ОПЕРАЦИЙ СО СВОБОДНОЙ ПАМЯТЬЮ</FONT></H2>
<P ALIGN="JUSTIFY"><FONT FACE="Times New Roman, Times, serif" SIZE="3">Как вы 
уже знаете из урока 31, если оператор</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new</I> 
не может выделить требуемую память из свободной памяти, он присваивает значение 
NULL вашей переменной-указателю. Следующая программа USE_FREE.CPP неоднократно 
вызывает оператор</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new,</I> 
выделяя каждый раз 1000 байт, пока свободная память не исчерпается:</FONT></P>
<BLOCKQUOTE> 
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">#include &lt;iostream.h&gt;</FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">void main (void) </FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">{<BR>
&nbsp;&nbsp;&nbsp;char 
*pointer;<BR>
&nbsp;&nbsp;&nbsp;do 
</FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pointer 
= new char[1000];<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if 
(pointer 1= NULL) cout 
&lt;&lt; "Выделено 1000 байт"</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3">&lt;&lt; 
endl;<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else 
cout &lt;&lt; "Свободной 
памяти нет</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3">" &lt;&lt; 
endl;<BR>
&nbsp;&nbsp;&nbsp;} 
while (pointer);<BR>
}</FONT></P>
</BLOCKQUOTE>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">Как видите, программа просто 
выполняет цикл, пока</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new</I> 
не присвоит указателю значение NULL. Если вы хотите, чтобы</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new</I> 
выполнил другие действия (что-нибудь отличное от тупого возвращения значения 
NULL), когда он не может удовлетворить запрос на память, то сначала вам следует 
определить функцию, которую должна вызывать ваша программа, если памяти недостаточно 
для удовлетворения запроса. Например, следующая функция</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>end_pro-gram</I> 
выводит на экран сообщение, а затем использует функцию библиотеки этапа выполнения</FONT> 
<FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>exit для</I> завершения 
программы:</FONT></P>
<BLOCKQUOTE> 
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">void end_program(void)</FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">{<BR>
&nbsp;&nbsp;&nbsp;cout 
&lt;&lt; "Запрос на память не может быть удовлетворен" &lt;&lt; 
endl;<BR>
&nbsp;&nbsp;&nbsp;exit(l);<BR>
}</FONT></P>
</BLOCKQUOTE>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">Чтобы заставить C++ вызывать 
функцию</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>end_program,</I> 
если</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new</I> не 
может удовлетворить запрос на память, вам необходимо вызвать функцию <I>set_new_handler,</I> 
указав ей функцию</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>end_program</I> 
в качестве параметра, как показано ниже:</FONT></P>
<BLOCKQUOTE>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">set_new_handler(end_program);</FONT></P>
</BLOCKQUOTE>
<P ALIGN="JUSTIFY"><FONT FACE="Times New Roman, Times, serif" SIZE="3">Следующая 
программа END_FREE.CPP вызывает функцию</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>end_program, 
</I>если</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new</I> 
не может удовлетворить запрос на память:</FONT></P>
<BLOCKQUOTE> 
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">#include &lt;iostream.h&gt;</FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">#include &lt;stdlib.h&gt; 
// Прототип exit</FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">#include &lt;new.h&gt; 
// Прототип set_new_handler</FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">void end_program(void)</FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">{<BR>
&nbsp;&nbsp;&nbsp;cout 
&lt;&lt; "Запрос на память не может быть удовлетворен" &lt;&lt; endl;<BR>
&nbsp;&nbsp;&nbsp;exit(l);<BR>
}</FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">void main(void) </FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">{<BR>
&nbsp;&nbsp;&nbsp;char* 
pointer;<BR>
&nbsp;&nbsp;&nbsp;set_new_handler(end_program);<BR>
&nbsp;&nbsp;&nbsp;do 
</FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">&nbsp;&nbsp;&nbsp;{<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pointer 
= new char[10000];<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cout 
&lt;&lt; "Выделено 10000 байт"</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3">&lt;&lt; 
endl;<BR>
&nbsp;&nbsp;&nbsp;} 
while (1);<BR>
}</FONT></P>
</BLOCKQUOTE>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">В данном случае программа 
просто завершается, если</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new</I> 
не может выделить память из свободной памяти. В зависимости от потребностей 
вашей программы вы могли бы использовать функцию для выделения памяти из другого 
источника, например из расширенной памяти компьютера, которая существует в среде 
MS-DOS. Кроме того, ваша программа могла бы освободить память распределенную 
ею для других целей, чтобы сделать доступной свободную память. Обеспечивая вашим 
программам возможность создавать обработчик ситуации отсутствия памяти, C++ 
предоставляет вам полный контроль над процессом распределения памяти.</FONT></P>
<H2 ALIGN="CENTER"> <FONT FACE="Arial, Helvetica, sans-serif">СОЗДАНИЕ СОБСТВЕННЫХ 
ОПЕРАТОРОВ <I>new</I> И <I>delete</I></FONT></H2>
<P ALIGN="JUSTIFY"><FONT FACE="Times New Roman, Times, serif" SIZE="3">Как вы 
знаете, C++ позволяет вашим программам перегружать операторы. Аналогично вы 
можете перегрузить операторы</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new</I> 
и</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>delete,</I> 
чтобы изменить их поведение. Например, предположим, что вы выделяете 100 байт 
памяти для хранения супер-секретных данных о вашей компании. Когда вы в дальнейшем 
освобождаете эту память с помощью оператора</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>delete,</I> 
освобождается буфер, который содержал эту память, т.е. те самые 100 байт, содержащие 
супер-секретные данные о вашей компании. Предположим, корпоративный шпион (и 
программист) имеет доступ к вашему компьютеру, его программа теоретически может 
распределить тот же 100-байтный массив в памяти вашего компьютера и изучить 
ваши супер-секреты. Перегружая</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3">оператор</FONT> 
<FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>delete,</I> ваша программа 
может сначала заполнить этот буфер нулями или другими бессмысленными символами, 
а потом освободить эту память. Следующая программа MYDELETE.CPP перегружает 
оператор</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>delete.</I> 
Она сначала перезаписывает 100 байт, на которые указывает указатель, а затем 
освобождает память, используя для этого функцию библиотеки этапа выполнения</FONT> 
<FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>free:</I></FONT></P>
<BLOCKQUOTE> 
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">#include &lt;iostream.h&gt; 
</FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">#include &lt;stdlib.h&gt; 
</FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">#include &lt;string.h&gt;</FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">static void operator 
delete(void *pointer) </FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">{<BR>
&nbsp;&nbsp;&nbsp;char 
*data = (char *) pointer;<BR>
&nbsp;&nbsp;&nbsp;int 
i;<BR>
&nbsp;&nbsp;&nbsp;for 
(i = 0; i &lt; 100; i++) data[i] = 0;<BR>
&nbsp;&nbsp;&nbsp;cout 
&lt;&lt; "Секрет в безопасности!"</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3">&lt;&lt; 
endl;<BR>
&nbsp;&nbsp;&nbsp;free(pointer);<BR>
}</FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">void main(void)</FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">{<BR>
&nbsp;&nbsp;&nbsp;char 
*pointer = new char[100];<BR>
&nbsp;&nbsp;&nbsp;strcpy(pointer, 
"Секреты моей компании");<BR>
&nbsp;&nbsp;&nbsp;delete 
pointer;<BR>
}</FONT></P>
</BLOCKQUOTE>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">При запуске программа выделяет 
память для строкового массива с помощью оператора</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new.</I> 
Затем она копирует секреты компании в эту строку. В дальнейшем программа использует 
перегруженный оператор</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>delete</I> 
для освобождения памяти. Внутри функции</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>delete</I> 
приведенный ниже оператор присваивает значение переменной</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>pointer</I> 
указателю на символьную строку:</FONT></P>
<BLOCKQUOTE>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">char *data = (char *) 
pointer;</FONT></P>
</BLOCKQUOTE>
<P ALIGN="JUSTIFY"><FONT FACE="Times New Roman, Times, serif" SIZE="3">Символы</FONT> 
<FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>(char *),</I> которые 
называются <I>оператором приведения типов,</I> предназначены только для того, 
чтобы сообщить компилятору C++, что функция знает, что она присваивает указатель 
типа</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>void (см.</I> 
выше параметры функции) указателю типа</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>char.</I> 
Если вы опустите оператор приведения типов, программа не откомпилируется. Затем 
функция копирует нули в 100 байт буфера и освобождает память, используя для 
этого функцию библиотеки этапа выполнения <I>free.</I> Очень важно отметить, 
что эта функция (оператор</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>delete)</I> 
работает только с областью памяти размером 100 байт. Поскольку данная программа 
выделяет память только один раз, она работает корректно. Если вы измените программу 
таким образом, чтобы выделялось только десять байт памяти и не сделаете подобных 
изменений в этой функции, то она перезапишет 90 байт памяти, которые ваша программа, 
возможно, использовала для других целей, приведя к ошибке. Однако, используя 
функции библиотеки этапа выполнения, ваши программы могут получить больше информации 
о размере области памяти, на которую указывает определенный указатель.</FONT></P>
<P ALIGN="JUSTIFY"> <FONT FACE="Times New Roman, Times, serif" SIZE="3">Подобным 
образом следующая программа NEW_OVER.CPP перегружает оператор C++ <I>new.</I> 
В данном случае перегруженная функция помещает символьную строку "Учимся программировать 
на языке C++!" в  выделяемой памяти:</FONT></P>
<BLOCKQUOTE> 
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">#include &lt;iostream.h&gt; 
</FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">#include &lt;alloc.h&gt; 
</FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">#include &lt;string.h&gt;</FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">static void *operator 
new(size_t size) </FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">{<BR>
&nbsp;&nbsp;&nbsp;char 
*pointer;<BR>
&nbsp;&nbsp;&nbsp;pointer 
= (char *) malloc(size);<BR>
&nbsp;&nbsp;&nbsp;if 
(size &gt; strlen( "Учимся программировать на языке C++!")) <BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; strcpy(pointer, "Учимся программировать 
на языке &nbsp;&nbsp;&nbsp;C++!");<BR>
&nbsp;&nbsp;&nbsp;return(pointer);<BR>
}</FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">void main(void) </FONT></P>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">{<BR>
&nbsp;&nbsp;&nbsp;char 
*str = new char[100];<BR>
&nbsp;&nbsp;&nbsp;cout 
&lt;&lt; str &lt;&lt; endl;<BR>
}</FONT></P>
</BLOCKQUOTE>
<P><FONT FACE="Times New Roman, Times, serif" SIZE="3">Как видите, функция</FONT> 
<FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new</I> использует для 
выделения памяти функцию <I>malloc</I> библиотеки этапа выполнения. Если размер 
выделяемой памяти достаточен для хранения строки "Учимся программировать на 
языке C++!", данная функция использует функцию</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>strcpy</I> 
библиотеки этапа выполнения для копирования строки в область памяти.</FONT></P>
<H2 ALIGN="CENTER"><FONT FACE="Arial, Helvetica, sans-serif">ЧТО ВАМ НЕОБХОДИМО 
ЗНАТЬ</FONT></H2>
<P ALIGN="JUSTIFY"><FONT FACE="Times New Roman, Times, serif" SIZE="3">По мере 
того как ваши программы становятся более сложными, вы будете выделять память 
в процессе выполнения, используя оператор</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new.</I> 
Из этого урока вы узнали, как изменить поведение оператора</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new,</I> 
сначала определяя функцию-обработчик, которую вызывает ваша программа, если</FONT> 
<FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new</I> не может удовлетворить 
запрос на память, а затем с помощью перегрузки самого оператора</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new.</I> 
Из урока 33 вы узнаете новые способы использования входного потока</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>cm</I> 
и выходного потока <I>соut </I>для усовершенствования возможностей ввода и вывода 
ваших программ. Прежде чем перейти к уроку 33, убедитесь, что вы изучили следующее:</FONT></P>
<OL>
<OL>
<LI><FONT FACE="Times New Roman, Times, serif" SIZE="3">Если оператор</FONT> 
<FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new</I> не может 
удовлетворить запрос на память, то по умолчанию он присваивает значение 
NULL соответствующему указателю.</FONT></LI>
<LI><FONT FACE="Times New Roman, Times, serif" SIZE="3">Если вашим программам 
необходима другая обработка в том случае, когда</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new</I> 
не может удовлетворить запрос на память, ваши программы могут определить 
свои собственные обработчики. Используя функцию <I>set_new_handler,</I> 
программа может заставить</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new</I> 
вызвать вашу функцию, если невозможно удовлетворить запрос на память.</FONT></LI>
<LI><FONT FACE="Times New Roman, Times, serif" SIZE="3">C++ позволяет вашим 
программам перегружать операторы</FONT> <FONT FACE="Times New Roman, Times, serif" SIZE="3"><I>new</I> 
и <I>delete.</I> Однако, прежде чем это сделать, вы должны иметь четкое 
представление о свободной памяти (куче) и функциях библиотеки этапа выполнения, 
которые ею манипулируют.</FONT></LI>
</OL>
</OL></td>
</tr>
</table>
</td>
</tr>
</table>
</td>
</tr>
</table>
</td>	
<td width="6" background="/art/pic/images/spliter_r.gif" valign="top"><img src="/art/pic/images/spl_r.gif" width="6" height="106"></td>
<td width="23%" bgcolor="#E0E6F1" valign="top">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr>
<td align="center" height="36" background="/art/pic/images/vip_caption.gif" class="caption" valign="middle">Полезная реклама</td>
</tr>
<tr>
<td background="/art/pic/images/left_block_bg.gif" style="padding-top: 15px; background-repeat: repeat-x">
<table cellpadding="5" cellspacing="5" border="0" width="100%" style="font-size: 11px;color:#404F71">
<tr>
<td width="27%" valign="top"><span style="font-size:11px;font-weight:bold">Здесь может быть твой баннер. Напиши и мы договоримся.</span>
</td>
</tr>
</table>
</td>
</tr>
<tr>
<td height="36" background="/art/pic/images/vip_caption.gif" class="caption" valign="middle">
<img src="/art/pic/images/irecommends.gif" height="12" width="15" hspace="15">Рекомендуем
</td>
</tr>
<tr>
<td background="/art/pic/images/left_block_bg.gif" style="padding-top: 15px; background-repeat: repeat-x;padding-left:25px;" class="themes">
<span style="font-size:11px;font-weight:bold">
<img src="/art/pic/images/theme_marker.gif"><a href="http://cgi.myweb.ru">Скрипты</a><br>
<img src="/art/pic/images/theme_marker.gif"><a href="http://download.ru">Бесплатный софт</a><br>
</span>
</td>
</tr>
</table>	</td>
<td background="/art/pic/images/lr_colums_r.gif" width="6"><img src="/art/pic/images/0.gif" height="1" width="6"></td>
</tr>
<tr>
<td colspan="7">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr>
<td background="/art/pic/images/bottom_bg.gif" height="80">
<table cellpadding="0" cellspacing="0" border="0" width="100%">
<tr>
<td style="padding-left: 25px; padding-right: 25px" width="151">
<a href="http://fastcode.ru/" title="FastCode - программирование, веб-программирование. Статьи и учебники по программированию и веб-дизайну, php, perl, asp, html, dhtml, java, javascript, css, xml, vrml, sql."><img border="0" src="/art/pic/images/bottom_logo.jpg" height="79" width="151" alt="FastCode - программирование, веб-программирование. Статьи и учебники по программированию и веб-дизайну, php, perl, asp, html, dhtml, java, javascript, css, xml, vrml, sql."></a>
</td>
<td class="copy" align="left" nowrap>
<b>Copyright © <a href="http://fastcode.ru" title="FastCode - программирование, веб-программирование. Статьи и Учебники">FastCode.ru</a> 2003-2005.<br>
При перепечатке материалов ссылка на автора материала обязательна.</b><br><br>
<span style="color: #7C8EAF;"><b>Дизайн:</b> Hangar, <b>Админ:</b> WebKroliK</span>
</td>
<td width="25%" align="center">
<a href="http://webstatus.ru" target="_blank" title="Студия ВебСтатус. Веб-дизайн и создание сайтов. Раскрутка и оптимизация сайтов"><img src="/art/pic/images/webstatus.gif" width="88" height="31" border="0" alt="Студия ВебСтатус. Веб-дизайн и создание сайтов. Раскрутка и оптимизация сайтов"></a>
<script language="JavaScript">
<!--
document.write('<a href="http://www.liveinternet.ru/click" '+
'target=_blank><img src="http://counter.yadro.ru/hit?t52.1;r'+
escape(document.referrer)+((typeof(screen)=='undefined')?'':
';s'+screen.width+'*'+screen.height+'*'+(screen.colorDepth?
screen.colorDepth:screen.pixelDepth))+';u'+escape(document.URL)+
';'+Math.random()+
'" title="LiveInternet: показано число просмотров и посетителей за 24 часа" '+
'border=0 width=88 height=31></a>')//-->
</script>
</td>
</tr>
</table>
</td>
</tr>
</table>	
</td>
</tr>
</table>
</body>
</html>